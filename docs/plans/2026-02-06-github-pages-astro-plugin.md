# Plugin Spec: github-pages-astro

**Date:** 2026-02-06
**Status:** Draft
**Plugin location:** `plugins/github-pages-astro/`

## Problem

Keeping documentation in sync with code is entirely manual. Claude has no awareness of a repo's doc site structure, conventions, or build process. Docs drift out of date as code evolves, new features go undocumented, and build errors go unnoticed until CI fails.

Beyond that, most docs are written for humans only. AI coding agents — Claude Code, Copilot, Cursor, etc. — increasingly consume project documentation to provide context, but human-optimized docs are a poor fit. They rely on narrative flow, implicit context, visual hierarchy, and cross-references that agents can't leverage. There's no `llms.txt`, no machine-readable summary, and no content written for chunk-based retrieval.

## Goal

A **reusable Claude Code plugin** that gives Claude full knowledge of any repo's Astro + Starlight documentation site and the tools to maintain it: scaffold a new site, add pages, update content, validate builds, and keep documentation in sync with the codebase.

**This plugin is installed once via the dot-skills marketplace into the user's Claude Code settings.** It is loaded from the marketplace cache (`CLAUDE_PLUGIN_ROOT`) in every session, across every repo. Repo-specific configuration lives in `.docs-config.json` in each project root (`CLAUDE_PROJECT_DIR`).

**Critically, the plugin maintains two parallel documentation tracks:**

1. **Human docs** — A Starlight site with rich navigation, progressive disclosure, and visual design. Deployed to GitHub Pages.
2. **Agent docs** — Machine-optimized content following the `llms.txt` standard, with self-contained pages, explicit context, consistent terminology, and structured metadata. Generated at build time alongside the human site.

The two tracks share a single source of truth but produce different outputs. The human site renders to HTML; the agent track renders to `llms.txt`, `llms-full.txt`, and `llms-small.txt` plus per-page Markdown endpoints.

## Distribution Model

This plugin follows the dot-skills marketplace distribution pattern:

| Concept | Location | Notes |
|---------|----------|-------|
| Plugin code | `plugins/github-pages-astro/` in the marketplace repo | Skills, commands, hooks, scripts — all generic |
| Marketplace cache | `~/.claude/plugins/cache/` (`CLAUDE_PLUGIN_ROOT`) | Read-only copy loaded each session |
| Per-repo config | `CLAUDE_PROJECT_DIR/.docs-config.json` | Generated by `/docs-init`, repo-specific |
| Per-repo site | `<site.directory>/` in the project | Astro + Starlight site, owned by the repo |

**Key constraint:** Plugin code in the cache is shared across all repos. Skills, commands, and hooks must be **generic** — they read `.docs-config.json` for anything repo-specific (site directory, base URL, sections, source mappings, terminology).

## `.docs-config.json` Specification

Generated by `/docs-init` and read by all commands, hooks, and scripts. Lives at `CLAUDE_PROJECT_DIR/.docs-config.json`.

```json
{
  "site": {
    "directory": "site",
    "baseUrl": "/my-project/",
    "siteUrl": "https://user.github.io",
    "contentDir": "src/content/docs"
  },
  "sections": [
    {
      "slug": "getting-started",
      "label": "Getting Started",
      "purpose": "Entry points for new users — overview, installation, quickstart"
    },
    {
      "slug": "guides",
      "label": "Guides",
      "purpose": "Task-oriented walkthroughs"
    },
    {
      "slug": "reference",
      "label": "Reference",
      "purpose": "Exhaustive technical details"
    }
  ],
  "sourceMappings": [
    {
      "source": "README.md",
      "docs": ["getting-started/overview"]
    },
    {
      "source": "docs/api-reference.md",
      "docs": ["guides/api-reference"]
    },
    {
      "source": "src/lib/**/*.ts",
      "docs": ["reference/api"]
    }
  ],
  "terminology": {
    "ticket": ["card", "item", "task"],
    "column": ["status", "stage", "lane"]
  },
  "agentDocs": {
    "quickReferencePage": "reference/agent-quick-reference",
    "llmsSmallExcludes": ["reference/design-docs"]
  }
}
```

### Field Reference

| Field | Type | Description |
|-------|------|-------------|
| `site.directory` | string | Path to the Astro site root, relative to project root |
| `site.baseUrl` | string | Base path for the deployed site (e.g., `/my-project/`) |
| `site.siteUrl` | string | Root URL of the deployment target (e.g., `https://user.github.io`) |
| `site.contentDir` | string | Content directory relative to the site root |
| `sections` | array | Sidebar sections with slug, label, and purpose description |
| `sourceMappings` | array | Maps source files/globs to the doc pages they inform |
| `sourceMappings[].source` | string | Source file path or glob pattern, relative to project root |
| `sourceMappings[].docs` | string[] | Doc page slugs that should reflect this source's content |
| `terminology` | object | Canonical term → array of synonyms to flag as inconsistent |
| `agentDocs.quickReferencePage` | string | Slug for the agent quick reference page |
| `agentDocs.llmsSmallExcludes` | string[] | Section slug prefixes to exclude from `llms-small.txt` |

## Bun-Everywhere Policy

All JavaScript/TypeScript tooling uses **Bun** as the single runtime, package manager, test runner, and bundler. No npm, no npx, no Node-specific tooling.

| Concern | Tool | Notes |
|---------|------|-------|
| Package manager | `bun install` | Replaces `npm ci` / `npm install`. Lockfile: `bun.lock` |
| Runtime | `bun run` | Replaces `node`. Runs TypeScript natively, no compilation step |
| Test runner | `bun test` | Built-in, Jest-compatible. No separate test framework needed |
| Bundler | `bun build` | Available if needed for custom build steps |
| Script execution | `bun run <script>` | For `package.json` scripts and direct `.ts` file execution |
| Dev server | `bunx astro dev` | Replaces `npx`. Runs Astro CLI through Bun |
| Build | `bunx astro build` | Replaces `npx astro build` |

**Why Bun everywhere:**
- Already the runtime for kanban-skill's server
- Native TypeScript execution eliminates build steps for scripts
- Faster installs and execution than npm/node
- Single tool to learn and configure

---

## Dual Documentation Architecture

### The `llms.txt` Standard

The site will implement the [`llms.txt` proposal](https://llmstxt.org/) — a convention for providing LLM-friendly documentation alongside human-facing sites. Three files are generated at build time:

| File | Purpose | Size target |
|------|---------|-------------|
| `/llms.txt` | Navigation index — links with brief descriptions. Table of contents for agents. | Small (fits any context window) |
| `/llms-full.txt` | Complete documentation concatenated into a single Markdown file. For deep ingestion or RAG. | Full corpus |
| `/llms-small.txt` | Ultra-compact version for constrained context windows. Core concepts only. Excludes sections listed in `agentDocs.llmsSmallExcludes` from `.docs-config.json`. | Minimal |

### Implementation: `starlight-llms-txt` Plugin

The [`starlight-llms-txt`](https://github.com/delucis/starlight-llms-txt) plugin (by Astro core team member Chris Swithinbank, ~17K weekly downloads) generates all three files at build time from existing Starlight content. Configuration in `astro.config.mjs`:

```js
import starlightLlmsTxt from 'starlight-llms-txt';

export default defineConfig({
  integrations: [
    starlight({
      plugins: [
        starlightLlmsTxt({
          projectName: '<project-name>',
          // customSet filters are configured per-repo based on
          // agentDocs.llmsSmallExcludes in .docs-config.json
        }),
      ],
    }),
  ],
});
```

This is the foundation — it gets us the `llms.txt` files for free from existing content. But the real value comes from writing content that works well for both audiences.

### Content Authoring for Dual Audiences

The fundamental insight: **AI reads documentation as isolated chunks, not as a continuous document.** Every section must be independently meaningful when extracted from its surrounding context.

This means human docs and agent docs diverge in specific ways:

| Dimension | Human-Optimized | Agent-Optimized |
|-----------|----------------|--------------|
| **Reading mode** | Sequential/scanning, follows visual hierarchy | Chunk-based retrieval, pattern-matches against queries |
| **Context** | Readers accumulate context across sections | Each chunk must be self-contained |
| **Terminology** | Stylistic variation acceptable | Strict consistency required (same term everywhere) |
| **References** | "As mentioned above", "see the previous section" | Explicit: "As described in the Ticket Format reference, tickets use `<type>--<slug>.md` naming" |
| **Density** | Balanced — explanation, examples, narrative | High density — concise, direct, no filler |
| **Metadata** | Implicit in URL, breadcrumbs, sidebar position | Explicit frontmatter: content type, version, scope |
| **Prose style** | Pronouns ("it", "this"), relative references | Explicit nouns, no vague antecedents |

### Strategy: Single Source, Dual Optimization

Rather than maintaining completely separate content trees, we optimize the shared source to work for both audiences:

**1. Structural rules (help both audiences):**
- One concept per page
- Strict heading hierarchy (never skip levels)
- Self-contained sections that stand alone when extracted
- Consistent terminology across all pages
- Fenced code blocks with language identifiers

**2. Agent-specific additions:**
- Rich frontmatter on every page (content type, scope, related pages)
- Opening summary paragraph on every page that restates the full context
- No implicit references — always name the thing being discussed
- Alt text on any images or diagrams (multimodal agents parse this)

**3. Agent-specific generated artifacts (build-time):**
- `llms.txt` / `llms-full.txt` / `llms-small.txt` via the Starlight plugin
- Per-page `.md` endpoints (Starlight can serve raw Markdown)

**4. Content that diverges enough to warrant separate pages:**
- A dedicated "AI Agent Quick Reference" page — a single dense page with every convention, format, and rule that an agent needs to work with the project. This is the page an agent would read to get full project context in one shot.
- This page lives in the human site too (under Reference) but is written in agent-optimized style: no narrative, pure structured data, every term defined inline.
- The slug for this page is configured in `agentDocs.quickReferencePage` in `.docs-config.json`.

### Proposed Frontmatter Extensions

Add optional frontmatter fields to content pages for agent consumption:

```yaml
---
title: Ticket Format
description: YAML frontmatter fields, naming conventions, and type prefixes for kanban tickets.
content-type: reference        # reference | guide | tutorial | overview
scope: kanban-skill            # which plugin/module this documents
ai-summary: >
  Kanban tickets are Markdown files named <type>--<slug>.md stored in
  kanban/{todo,in-progress,ready-to-review,done}/. Required frontmatter:
  type, project, created, priority. Optional: workstream, depends-on,
  depends-on-workstreams, tags.
related:
  - getting-started/overview
  - guides/kanban-board
---
```

The `ai-summary` field gives agents a pre-written chunk they can use without parsing the full page. The `content-type` and `scope` fields help agents filter for relevant pages. `related` makes the link graph explicit.

### Agent Discovery

Agents need a reliable chain of breadcrumbs to find and consume the documentation. The plugin establishes these discovery paths:

1. **`llms.txt` at site root** — The primary entry point. Any agent that knows the site URL can fetch `/llms.txt` to get a table of contents, then `/llms-full.txt` for the complete corpus.
2. **`CLAUDE.md` / `AGENTS.md` in the repo** — `/docs-init` adds a reference to the published docs URL and `llms.txt` location. `/docs-sync` verifies this reference exists and the URL is current.
3. **README** — The repo's README should link to the docs site. `/docs-init` can suggest adding this.

This chain ensures agents can discover documentation whether they start from the deployed site, the repo's AI configuration files, or the README.

---

## Plugin Structure

```
plugins/github-pages-astro/
├── .claude-plugin/
│   └── plugin.json
├── commands/
│   ├── docs-init.md           # Scaffold site + generate .docs-config.json
│   ├── docs-dev.md            # Start Astro dev server (via bunx)
│   ├── docs-build.md          # Build site and report errors (via bunx)
│   └── docs-sync.md           # Check docs freshness against codebase
├── skills/
│   ├── docs-site/
│   │   └── SKILL.md            # Astro + Starlight knowledge, reads .docs-config.json
│   └── dual-docs/
│       └── SKILL.md            # Agent-optimized writing conventions
├── hooks/
│   ├── hooks.json
│   ├── docs-freshness-check.sh # Stop hook: remind about doc updates
│   └── stop-dev-server.sh      # SessionEnd hook: kill astro dev
└── scripts/
    ├── freshness-check.ts      # Compare code state to doc state (bun run)
    └── link-validator.ts       # Validate internal links (bun run)
```

---

## Components

### 1. Command: `docs-init`

**File:** `commands/docs-init.md`

```yaml
---
name: docs-init
description: Scaffold an Astro + Starlight doc site and generate .docs-config.json for this repo
allowed-tools: [Bash, Read, Write, Glob, Grep]
---
```

**Behavior:**

This is the entry point for any new repo. It bootstraps the entire documentation infrastructure.

**Step 1: Gather project context**
1. Read `CLAUDE.md`, `README.md`, `package.json`, and directory structure to understand the project
2. Identify likely source-of-truth files (READMEs, doc directories, config files, skill files)
3. Ask the user to confirm/adjust: site directory name, GitHub Pages base URL, initial sections, and source mappings

**Step 2: Generate `.docs-config.json`**
1. Write the config file to `CLAUDE_PROJECT_DIR/.docs-config.json` with the gathered information
2. Populate `sections` based on detected content structure
3. Populate `sourceMappings` with discovered source-to-doc relationships
4. Set `terminology` based on project domain (can be empty initially)
5. Configure `agentDocs` defaults

**Step 3: Scaffold the Astro site** (if one doesn't exist)
1. Create the site directory with `bun create astro` or manual scaffold
2. Install dependencies: `bun add astro @astrojs/starlight starlight-llms-txt`
3. Generate `astro.config.mjs` with Starlight + `starlight-llms-txt` configuration
4. Create initial content pages based on detected sections
5. Create `tsconfig.json`, `.gitignore`, `package.json`

**Step 4: Scaffold GitHub Actions workflows**
1. Generate `.github/workflows/deploy-docs.yml` — deploy on push to main
2. Generate `.github/workflows/docs-pr-check.yml` — build check on PRs
3. Both workflows use Bun (not npm/Node)

**Step 5: Update agent discovery files**
1. Add docs site URL and `llms.txt` reference to `CLAUDE.md` (if it exists)
2. Suggest adding docs link to `README.md`

**Note:** If a site already exists, `/docs-init` should detect it and only generate `.docs-config.json` (skipping scaffolding). This supports adopting the plugin in repos with existing Astro sites.

### 2. Skill: `docs-site`

**File:** `skills/docs-site/SKILL.md`

Teaches Claude everything it needs to author and maintain an Astro + Starlight doc site. **This skill is generic** — it teaches Astro/Starlight concepts universally and reads `.docs-config.json` for repo-specific details.

**Content the skill should cover:**

#### Astro + Starlight fundamentals
- Astro is a static site generator; Starlight is its documentation theme
- Content lives in `<site.contentDir>/` (from `.docs-config.json`, typically `src/content/docs/`)
- Content collection defined in `src/content.config.ts` (standard Starlight `docsLoader`)
- `starlight-llms-txt` plugin generates `llms.txt`, `llms-full.txt`, `llms-small.txt` at build time
- Built-in components: `Card`, `CardGrid`, `LinkCard`, `Tabs`, `TabItem`
- Build: `bun install && bunx astro build` from the site directory
- Dev server: `bunx astro dev` from the site directory

#### Reading `.docs-config.json`
- Always read `CLAUDE_PROJECT_DIR/.docs-config.json` before any docs work
- The config tells you: where the site lives, what the base URL is, what sections exist, what source files map to what doc pages, and project terminology
- If `.docs-config.json` doesn't exist, suggest running `/docs-init` first

#### Content conventions
- Pages are `.md` or `.mdx` files under the content directory
- Required frontmatter: `title`, `description`
- Optional Starlight frontmatter: `sidebar.order`, `sidebar.badge`, `tableOfContents`, `template`
- Landing pages use `template: splash`; all other pages use the default `doc` template
- Internal links must include the base URL prefix from `.docs-config.json`

#### Sidebar management
- Sidebar is defined manually in `astro.config.mjs` (not autogenerated)
- Every new content page MUST have a corresponding entry in the sidebar config
- Sidebar structure mirrors the section slugs defined in `.docs-config.json`
- Sidebar entries use `slug` (not `link`) pointing to the content path without file extension

#### Section purposes
- Read from `.docs-config.json` `sections` array
- Each section has a `slug`, `label`, and `purpose` that guides what content belongs there
- When creating new pages, match the page's content to the appropriate section's purpose

#### Source-of-truth relationships
- Read from `.docs-config.json` `sourceMappings` array
- Each mapping connects a source file or glob to the doc pages it informs
- When a source file changes, the corresponding doc pages may need updating
- When editing a doc page, check what source files it maps to for accuracy

#### Writing style
- Use second person ("you") for guides, third person for reference docs
- Keep pages focused — one concept per page
- Use tables for structured data
- Use code blocks with language tags for examples
- No trailing slashes in source-level links (Astro handles this)

### 2b. Skill: `dual-docs`

**File:** `skills/dual-docs/SKILL.md`

Teaches Claude the principles and conventions for writing documentation that serves both human readers and AI agents. Active alongside `docs-site` whenever Claude authors or edits documentation content.

**Content the skill should cover:**

#### The dual-audience model
- Every content page is authored once but consumed two ways: rendered HTML for humans, raw Markdown for agents
- The `starlight-llms-txt` plugin auto-generates `llms.txt`, `llms-full.txt`, `llms-small.txt` from content pages at build time
- Agent-optimized content follows the same source files — no separate content tree to maintain

#### Writing rules for agent compatibility
- **Self-contained sections** — every section must make sense when extracted in isolation. No "as mentioned above" or "see the previous section." Always name the thing explicitly.
- **Consistent terminology** — use the canonical terms from `.docs-config.json` `terminology`. If the config lists `ticket` as canonical with synonyms `card`, `item`, `task`, always use "ticket."
- **Explicit nouns over pronouns** — avoid "it", "this", "these" when the antecedent could be ambiguous. Repeat the noun.
- **No implicit context** — don't assume the reader has read other pages. State prerequisites and definitions inline.
- **Dense opening paragraphs** — every page starts with a 2-3 sentence summary that restates the full context: what this page covers, what system it's part of, and why it matters. This is the chunk agents are most likely to retrieve.
- **Strict heading hierarchy** — never skip levels (H1 → H3). Agents build semantic maps from heading structure.
- **Fenced code blocks with language tags** — always. Agents parse these for executable examples.

#### Required frontmatter for agent consumption
Every content page must include these frontmatter fields:

```yaml
---
title: <Page Title>
description: <1-2 sentence description, optimized for search/retrieval>
content-type: reference | guide | tutorial | overview
scope: <module or component this documents>
ai-summary: >
  <3-5 sentence dense summary of the entire page content,
  written for an agent that will not read the full page.
  Include key facts, formats, and rules.>
related:
  - <slug of related page 1>
  - <slug of related page 2>
---
```

#### The AI Agent Quick Reference page
- A single dedicated page (slug configured in `agentDocs.quickReferencePage`)
- Contains every convention, format, and rule needed to work with the project
- Written entirely in agent-optimized style: no narrative, structured data, every term defined inline
- This is the page agents should read first for full project context in one shot
- Think of it as `CLAUDE.md` but more comprehensive and publicly accessible

### 3. Command: `docs-dev`

**File:** `commands/docs-dev.md`

```yaml
---
name: docs-dev
description: Start the documentation site dev server for live preview
allowed-tools: [Bash, Read]
---
```

**Behavior:**
1. Read `.docs-config.json` to get site directory and base URL
2. Check that Bun is installed
3. Run `bun install` in the site directory if `node_modules/` doesn't exist
4. Start `bunx astro dev` in the background from the site directory
5. Save PID to `<site-dir>/.astro-dev.pid`
6. Print the local URL (e.g., `http://localhost:4321/<baseUrl>`)
7. Inform the user the server will auto-stop when the session ends

### 4. Command: `docs-build`

**File:** `commands/docs-build.md`

```yaml
---
name: docs-build
description: Build the documentation site and report any errors
allowed-tools: [Bash, Read]
---
```

**Behavior:**
1. Read `.docs-config.json` to get site directory
2. Run `bun install` in the site directory if needed
3. Run `bunx astro build` in the site directory
4. If build succeeds: report success and output path (`<site-dir>/dist/`), confirm `llms.txt` files were generated
5. If build fails: display the full error output and suggest fixes
6. Validate that `llms.txt`, `llms-full.txt`, and `llms-small.txt` exist in the build output
7. Optionally run link validation (see scripts section)

### 5. Command: `docs-sync`

**File:** `commands/docs-sync.md`

```yaml
---
name: docs-sync
description: Check documentation freshness against the codebase
allowed-tools: [Bash, Read, Glob, Grep]
---
```

**Behavior:**

This is the most interesting command. It performs a freshness audit driven entirely by `.docs-config.json`:

**Content freshness (driven by `sourceMappings`):**
1. **Source mapping staleness** — For each entry in `sourceMappings`, compare the modification timestamps of source files against their mapped doc pages. Flag when a source has been modified more recently than its corresponding docs.
2. **Sidebar completeness** — Verify every `.md`/`.mdx` file in the content directory has a sidebar entry in `astro.config.mjs`, and vice versa.
3. **Source coverage discovery** — Expand all glob patterns in `sourceMappings` and check if any new files match existing patterns but aren't yet known. For example, if `src/lib/**/*.ts` is a source pattern and a new file `src/lib/auth.ts` was added, flag it as a potentially unmapped source. This helps the user keep `sourceMappings` up to date as the codebase grows.

**Agent-readiness audit (warnings only):**
4. **Frontmatter completeness** — Check that every content page has the recommended agent frontmatter fields (`content-type`, `scope`, `ai-summary`, `related`). Report as warnings, not errors.
5. **Self-containment check** — Scan for anti-patterns: "as mentioned above", "see above", "the previous section", vague pronouns at section starts.
6. **Terminology consistency** — Using the `terminology` map from `.docs-config.json`, flag pages that use synonym terms instead of the canonical term.
7. **Agent quick reference freshness** — If `agentDocs.quickReferencePage` is configured, verify the page exists and has been updated recently.

**Agent discovery verification:**
8. **CLAUDE.md/AGENTS.md reference check** — Verify that `CLAUDE.md` or `AGENTS.md` contains a reference to the published docs URL and `llms.txt` location. Flag if missing or if the URL appears stale.

**Output:** A report listing stale/missing/diverged docs with suggested actions, grouped by content freshness issues and agent-readiness warnings. Claude works through the report as a todo list.

### 6. Hook: `docs-freshness-check` (Stop)

**File:** `hooks/docs-freshness-check.sh`

**Trigger:** Stop (runs when Claude tries to end a turn)

**Logic:**
1. Read `.docs-config.json` to get `sourceMappings`
2. Check `git diff --name-only HEAD` for files modified in this session
3. For each modified file, check if it matches any source pattern in `sourceMappings`
4. If a source match is found, check whether the corresponding doc pages were also modified
5. If source files were modified but their mapped doc pages were not: exit code 2 with a message reminding Claude to update docs
6. If no relevant source files changed, or if docs were also updated: exit 0
7. If `.docs-config.json` doesn't exist: exit 0 (plugin not initialized for this repo)

**Important design decision:** This hook should be conservative. It should only fire when there's a clear signal that docs are stale — not on every code change. False positives train users to ignore the hook.

### 7. Hook: `stop-dev-server` (SessionEnd)

**File:** `hooks/stop-dev-server.sh`

**Trigger:** SessionEnd

**Logic:**
1. Read `.docs-config.json` to get the site directory
2. Check for `<site-dir>/.astro-dev.pid`
3. If found, read PID and kill the process
4. Fallback: `pkill -f "astro dev"` scoped to the site directory
5. Remove PID file

### 8. Scripts

Utility scripts that commands invoke. These live in `scripts/` rather than `hooks/` because they're tools, not lifecycle hooks.

#### `freshness-check.ts`

A Bun script that implements the freshness audit logic for `docs-sync`. Extractable into a script so both the command and the hook can share logic.

**Inputs:** Project root path, path to `.docs-config.json`
**Output:** JSON report of stale/missing/diverged items

```typescript
interface FreshnessReport {
  sidebarOrphans: string[];        // sidebar entries with no matching file
  undocumentedPages: string[];     // content files with no sidebar entry
  stalePages: StaleItem[];         // pages that may be out of date
  newSourceMatches: SourceMatch[]; // files matching source globs but not in config
  agentWarnings: AgentWarning[];   // agent-readiness issues (warnings only)
  discoveryIssues: string[];       // missing CLAUDE.md/AGENTS.md references
}

interface StaleItem {
  docPage: string;
  sourceFile: string;
  reason: string;  // e.g., "source modified more recently than doc"
}

interface SourceMatch {
  file: string;
  matchedPattern: string;
  suggestedDocs: string[];  // doc slugs from the matching sourceMappings entry
}

interface AgentWarning {
  page: string;
  issue: string;  // e.g., "missing ai-summary", "uses synonym 'card' instead of 'ticket'"
}
```

#### `link-validator.ts`

A Bun script that crawls the built site output (`<site-dir>/dist/`) and validates:
- All internal links resolve to existing pages
- Anchor links (`#section`) point to existing headings
- No broken image references

**Inputs:** Path to build output directory
**Output:** List of broken links with source page and target

---

## Marketplace Registration

Add the new plugin to `.claude-plugin/marketplace.json`:

```json
{
  "plugins": [
    { "name": "kanban-skill", "..." : "..." },
    {
      "name": "github-pages-astro",
      "source": "./plugins/github-pages-astro",
      "description": "Documentation site management for Astro + Starlight on GitHub Pages",
      "version": "1.0.0",
      "author": { "name": "David Kormushoff" }
    }
  ]
}
```

## Plugin Registration

**File:** `plugins/github-pages-astro/.claude-plugin/plugin.json`

```json
{
  "name": "github-pages-astro",
  "description": "Documentation site management for Astro + Starlight on GitHub Pages",
  "version": "1.0.0",
  "author": { "name": "David Kormushoff" },
  "hooks": "./hooks/hooks.json"
}
```

---

## Resolved Design Decisions

### Decisions

1. **Separate plugin, not part of kanban-skill.** The doc site is a distinct concern. Keeping it as its own plugin means it can be enabled/disabled independently and reused across any repo with an Astro + Starlight site.

2. **Reusable plugin, generic skills.** The plugin is installed once via the marketplace and loaded from the cache in every session. All skills and commands are generic — they read `.docs-config.json` for repo-specific details. The plugin code never references specific repos, paths, sections, or source files.

3. **`/docs-init` generates per-repo config.** Rather than hardcoding repo specifics into the plugin, `/docs-init` scans the project and generates `.docs-config.json`. This is the bridge between the generic plugin and each specific repo.

4. **Report only, not auto-fix.** `docs-sync` produces a report; Claude works through it as a todo list. Auto-fixing is risky — doc pages may have framework-specific formatting that raw copying would break.

5. **Workflows scaffolded by `/docs-init`, then repo-owned.** `/docs-init` generates the initial GitHub Actions workflows with Bun. After that, the repo owns them — the plugin doesn't validate or modify workflows on an ongoing basis.

6. **Freshness checks are config-driven.** The Stop hook and `docs-sync` only check what's declared in `sourceMappings` in `.docs-config.json`. They don't guess about undeclared directories or make repo-specific assumptions. New unmapped sources are discovered by `docs-sync` matching existing glob patterns, not by a separate hook.

7. **Soft doc-freshness enforcement via Stop hook.** The hook reminds but doesn't hard-block. Hard-blocking would be too aggressive — not every code change needs a doc update, and the heuristic can't be perfect.

8. **Sidebar is manually managed, not autogenerated.** Starlight supports autogenerated sidebar from directory structure, but manual control gives better labeling and ordering. The plugin validates that sidebar entries and files stay in sync rather than trying to autogenerate.

9. **Bun everywhere.** Bun is the sole JS/TS toolchain — runtime, package manager, test runner, bundler. No npm, no npx, no Node-specific tooling. This applies to the doc site, all plugin scripts, CI workflows, and any future JS/TS code.

10. **Single source, dual output.** Human and agent docs come from the same content files. Agent-optimized artifacts (`llms.txt` files) are generated at build time by `starlight-llms-txt`. There is no separate agent content tree to maintain.

11. **`starlight-llms-txt` for agent discovery.** Rather than building custom agent-doc generation, use the established Starlight plugin. It's maintained by an Astro core team member, handles the full `llms.txt` spec, and integrates cleanly with the existing build.

12. **Agent optimization is a writing discipline, not a tool.** The `dual-docs` skill teaches Claude how to write content that works for both audiences. The tooling validates compliance (`docs-sync` agent-readiness audit) but the content itself is authored once in a dual-compatible style.

13. **Dedicated Agent Quick Reference page.** One dense, structured page that gives any AI agent full project context in a single read. More useful than `llms-full.txt` for coding agents because it's curated, not concatenated.

14. **Agent-readiness checks are warnings only.** Missing `ai-summary` fields and other agent-optimized frontmatter produce warnings in `docs-sync`, not errors or PR blockers. Let the discipline develop before enforcing.

15. **`llms-small.txt` excludes are configurable.** The `agentDocs.llmsSmallExcludes` field in `.docs-config.json` controls which section prefixes are filtered out of the compact agent version. This allows each repo to tune what fits in tight context windows.

16. **No MCP server for v1.** An MCP server for dynamic documentation queries is a future enhancement, not in scope for v1. However, the agent discovery chain (llms.txt → CLAUDE.md/AGENTS.md → README) is documented and validated to ensure agents can find documentation through static paths today.

17. **Print URL, don't open browser.** `/docs-dev` prints the local URL rather than attempting to open a browser. More portable across environments (desktop, SSH, headless).

---

## Implementation Order

Recommended build sequence:

### Phase 1: Foundation + Init
1. **Plugin scaffold** — Create directory structure, `plugin.json`, empty `hooks.json`
2. **Command: `/docs-init`** — The entry point. Implement site detection, config generation, Astro scaffolding, workflow generation, and agent discovery file updates
3. **`.docs-config.json` schema** — Finalize and document the config format; `/docs-init` produces it

### Phase 2: Skills (highest value, no code dependencies)
4. **Skill: `docs-site`** — Write the generic SKILL.md with Astro/Starlight knowledge and `.docs-config.json` reading instructions
5. **Skill: `dual-docs`** — Write the SKILL.md with dual-audience writing conventions

### Phase 3: Commands and hooks
6. **Command: `/docs-dev`** — Dev server command (via `bunx`) + SessionEnd hook to clean up
7. **Command: `/docs-build`** — Build command with `llms.txt` validation
8. **Command: `/docs-sync`** — Freshness audit driven by `.docs-config.json` source mappings, including source coverage discovery and agent-readiness warnings
9. **Script: `freshness-check.ts`** — Shared freshness logic (runs via `bun run`)
10. **Hook: `docs-freshness-check`** — Stop hook using freshness logic and `sourceMappings`
11. **Script: `link-validator.ts`** — Post-build link validation (runs via `bun run`)

### Phase 4: Content (for dot-skills repo specifically)
12. **Run `/docs-init` on dot-skills** — Generate `.docs-config.json`, migrate existing workflows to Bun
13. **Add agent frontmatter to existing pages** — Add `content-type`, `scope`, `ai-summary`, `related` to all existing content pages
14. **Write Agent Quick Reference page** — The single-page dense summary for AI agents
15. **Marketplace registration** — Add to `marketplace.json`
16. **Update existing docs** — Add a page about this plugin to the doc site itself

---

## Component Interaction Diagram

```
┌───────────────────────────────────────────────────────────────┐
│                     Claude Code Session                       │
│                                                               │
│  ┌──────────────────┐  ┌───────────────┐  ┌───────────────┐  │
│  │    Commands      │  │    Skills     │  │     Hooks     │  │
│  │                  │  │               │  │               │  │
│  │ /docs-init       │  │ docs-site:    │  │ Stop: check   │  │
│  │ scaffolds site   │  │ Astro +       │  │ doc freshness │  │
│  │ + generates      │  │ Starlight     │  │ via source    │  │
│  │ .docs-config     │  │ (generic,     │  │ mappings      │  │
│  │                  │  │  reads        │  │               │  │
│  │ /docs-dev        │  │  config.json) │  │ SessionEnd:   │  │
│  │ starts dev       │  │               │  │ stop dev      │  │
│  │ server           │  │ dual-docs:    │  │ server        │  │
│  │                  │  │ agent-friendly│  │               │  │
│  │ /docs-build      │  │ writing rules │  │               │  │
│  │ builds site      │  │ & frontmatter │  │               │  │
│  │ + validates      │  │ conventions   │  │               │  │
│  │ llms.txt         │  │               │  │               │  │
│  │                  │  │               │  │               │  │
│  │ /docs-sync       │  │               │  │               │  │
│  │ audits freshness │  │               │  │               │  │
│  │ via config       │  │               │  │               │  │
│  └────────┬─────────┘  └───────────────┘  └───────┬───────┘  │
│           │                                        │          │
└───────────┼────────────────────────────────────────┼──────────┘
            │                                        │
            ▼                                        ▼
  ┌───────────────────┐                  ┌────────────────────┐
  │ .docs-config.json │◄─────────────────│  Source files       │
  │ (per-repo config) │   sourceMappings │  (code, READMEs,   │
  └────────┬──────────┘   drive checks   │   CLAUDE.md, etc.) │
           │                             └────────────────────┘
           ▼
    ┌──────────────┐
    │  <site-dir>/ │
    │  (Astro +    │
    │  Starlight   │
    │  + llms-txt  │
    │   plugin)    │
    └──────┬───────┘
           │
      bunx astro build
           │
     ┌─────┴──────┐
     ▼            ▼
 ┌────────┐  ┌──────────────┐
 │  HTML  │  │  llms.txt    │
 │  site  │  │  llms-full   │
 │  for   │  │  llms-small  │
 │ humans │  │  for agents  │
 └───┬────┘  └──────┬───────┘
     │              │
     └──────┬───────┘
            ▼
     ┌─────────────┐
     │  GitHub     │
     │  Pages      │
     │  (serves    │
     │  both)      │
     └──────┬──────┘
            │
            ▼
     ┌─────────────────┐
     │  Agent          │
     │  Discovery      │
     │  Chain:         │
     │  llms.txt →     │
     │  CLAUDE.md →    │
     │  README         │
     └─────────────────┘
```
